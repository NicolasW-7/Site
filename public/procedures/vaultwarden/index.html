<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>üî• Nicolas Wailly AIS DevOPs üî•</title>
<meta name=keywords content><meta name=description content="Vaultwarden Installation
The goal of this procedure is to simplify the installation of Vaultwarden using Docker.
Prerequisites:
A Debian machine virtual or physique; the method works on multiple distributions, but commands may need to be adapted for Docker installation.
Docker Installation
Configure the Docker Repository
Source: https://github.com/NicolasW-7/AIS-Brief-et-TIPS/blob/main/Procedure/Docker/Installation%20Docker.md?plain=1


Update the package list:
sudo apt-get update


Install the necessary packages:
sudo apt-get install ca-certificates curl gnupg


Create the directory for the repository keys:"><meta name=author content="Nicolas Wailly"><link rel=canonical href=//localhost:1313/procedures/vaultwarden/><link crossorigin=anonymous href=/assets/css/stylesheet.d72444526d7ecbdb0015438a7fa89054a658bf759d0542e2e5df81ce94b493ee.css integrity="sha256-1yREUm1+y9sAFUOKf6iQVKZYv3WdBULi5d+BzpS0k+4=" rel="preload stylesheet" as=style><link rel=icon href=//localhost:1313/favicon.ico><link rel=icon type=image/png sizes=16x16 href=//localhost:1313/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=//localhost:1313/favicon-32x32.png><link rel=apple-touch-icon href=//localhost:1313/apple-touch-icon.png><link rel=mask-icon href=//localhost:1313/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=//localhost:1313/procedures/vaultwarden/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="//localhost:1313/procedures/vaultwarden/"><meta property="og:site_name" content="üî• Nicolas Wailly AIS DevOPs üî•"><meta property="og:title" content="üî• Nicolas Wailly AIS DevOPs üî•"><meta property="og:description" content="Vaultwarden Installation The goal of this procedure is to simplify the installation of Vaultwarden using Docker.
Prerequisites: A Debian machine virtual or physique; the method works on multiple distributions, but commands may need to be adapted for Docker installation.
Docker Installation Configure the Docker Repository Source: https://github.com/NicolasW-7/AIS-Brief-et-TIPS/blob/main/Procedure/Docker/Installation%20Docker.md?plain=1
Update the package list:
sudo apt-get update Install the necessary packages:
sudo apt-get install ca-certificates curl gnupg Create the directory for the repository keys:"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="procedures"><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="Vaultwarden Installation
The goal of this procedure is to simplify the installation of Vaultwarden using Docker.
Prerequisites:
A Debian machine virtual or physique; the method works on multiple distributions, but commands may need to be adapted for Docker installation.
Docker Installation
Configure the Docker Repository
Source: https://github.com/NicolasW-7/AIS-Brief-et-TIPS/blob/main/Procedure/Docker/Installation%20Docker.md?plain=1


Update the package list:
sudo apt-get update


Install the necessary packages:
sudo apt-get install ca-certificates curl gnupg


Create the directory for the repository keys:"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Procedures","item":"//localhost:1313/procedures/"},{"@type":"ListItem","position":2,"name":"","item":"//localhost:1313/procedures/vaultwarden/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"","name":"","description":"Vaultwarden Installation The goal of this procedure is to simplify the installation of Vaultwarden using Docker.\nPrerequisites: A Debian machine virtual or physique; the method works on multiple distributions, but commands may need to be adapted for Docker installation.\nDocker Installation Configure the Docker Repository Source: https://github.com/NicolasW-7/AIS-Brief-et-TIPS/blob/main/Procedure/Docker/Installation%20Docker.md?plain=1\nUpdate the package list:\nsudo apt-get update Install the necessary packages:\nsudo apt-get install ca-certificates curl gnupg Create the directory for the repository keys:\n","keywords":[],"articleBody":"Vaultwarden Installation The goal of this procedure is to simplify the installation of Vaultwarden using Docker.\nPrerequisites: A Debian machine virtual or physique; the method works on multiple distributions, but commands may need to be adapted for Docker installation.\nDocker Installation Configure the Docker Repository Source: https://github.com/NicolasW-7/AIS-Brief-et-TIPS/blob/main/Procedure/Docker/Installation%20Docker.md?plain=1\nUpdate the package list:\nsudo apt-get update Install the necessary packages:\nsudo apt-get install ca-certificates curl gnupg Create the directory for the repository keys:\nsudo install -m 0755 -d /etc/apt/keyrings Download and add the Docker GPG key:\ncurl -fsSL https://download.docker.com/linux/debian/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg Change the permissions of the GPG key:\nsudo chmod a+r /etc/apt/keyrings/docker.gpg Add the Docker repository to the APT sources list:\necho \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/debian $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list \u003e /dev/null Update the package list to include the Docker repository:\nsudo apt-get update Install the necessary Docker packages:\nsudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin Verify Docker Installation Check the status of the Docker service:\nsystemctl status docker If Docker is ‚Äúactive (running)‚Äù, enable the Docker service to start automatically after the machine reboots:\nsudo systemctl enable docker Useful Docker Commands docker ps -a: Shows all containers, including their status, creation date, age, name, and ID. docker stop / docker rm : Stops (stop) and removes (rm) a container by adding its ID. docker compose up -d: Runs the docker-compose.yml file to start the containers in detached mode (-d). Command Details docker ps -a Displays all containers, whether running or stopped, with information such as:\nContainer ID Image used Command executed Creation date Status (running, stopped, etc.) Exposed ports Container names docker stop / docker rm docker stop : Stops a running container. docker rm : Removes a stopped container. Example:\ndocker stop 1a2b3c4d5e6f docker rm 1a2b3c4d5e6f Creating Self-Signed Certificates with OpenSSL For this part, we will use self-signed certificates. In production, we will reproduce this step by copying the certificates.\nOnce Docker is installed, we will need certificates for connecting to the VaultWarden web interface. To do this, create the /ssl and /docker directories at the root of our Debian machine if they don‚Äôt already exist:\nmkdir /ssl mkdir /docker /ssl will be used to store the .csr, .crt, and .key files we will create, and /docker will contain the configuration files for our containers.\nContinue by generating the self-signed certificates. Move to the /ssl directory:\ncd /ssl Create the following four files: .pem, .key, .crt, and .csr:\nopenssl genrsa -des3 -out vaultwarden.key 2048 openssl req -x509 -new -nodes -key vaultwarden.key -sha256 -days 10000 -out vaultwarden.pem openssl genrsa -out vaultwarden.key 2048 openssl req -new -key vaultwarden.key -out vaultwarden.csr openssl x509 -req -days 10000 -in vaultwarden.csr -signkey vaultwarden.key -out vaultwarden.crt Note: The generated certificate is valid for 10,000 days (about 27 years). This variable can be adjusted as needed. If necessary, a new certificate can be reissued on the machine using the CA created above.\nCreating Docker-Compose.yml and CaddyFile Configuration Files for Deploying Containers A. Creating the Caddyfile Access the /docker directory and create the files necessary for deploying the Caddy and Vaultwarden containers via Docker. Start with the Caddyfile:\nnano Caddyfile Copy the following content into it:\nThe first line corresponds to the title of our vaultwarden page, which will be accessible via a web browser.\n*your domain name* { tls internal encode gzip reverse_proxy /notifications/hub vaultwarden:3012 reverse_proxy vaultwarden:80 } To save, simply press Ctrl+X and then O.\nWith the CaddyFile created, proceed to the docker-compose.yml file:\nB. Creating the Docker-Compose.yml File ```sh\rnano docker-compose.yml\r```\rCopy the following content:\r```sh\rversion: '3.7'\rservices:\rvaultwarden:\rimage: vaultwarden/server:latest\rcontainer_name: vaultwarden\rrestart: always\renvironment:\rWEBSOCKET_ENABLED: true\rADMIN_TOKEN: #YourAdminToken\rDOMAIN: \"YourDomain\" # Your domain; vaultwarden needs to know it's https to work properly with attachments\rvolumes:\r- vw-data:/data\rcaddy:\rimage: caddy:2\rcontainer_name: caddy\rrestart: always\rports:\r# Needed for the ACME HTTP-01 challenge.\r- 443:443\rvolumes:\r- ./Caddyfile:/etc/caddy/Caddyfile:ro\r- ./ssl:/ssl\r- caddy-config:/config\r- caddy-data:/data\r- caddy-logs:/logs\renvironment:\r- DOMAIN= # Your domain.\r#EMAIL: \"YOUR EMAIL\" # The email address to use for ACME registration.\r#LOG_FILE: \"/data/access.log\"\rvolumes:\rvw-data:\rcaddy-config:\rcaddy-data:\rcaddy-logs:\r```\rC. Enabling the Admin Console These lines enable the admin console:\n```sh\rWEBSOCKET_ENABLED: true\rADMIN_TOKEN: YourAdminToken\r```\rThey can be omitted or modified to hide the admin console token (password).\nTo hide the token, add these lines:\nWEBSOCKET_ENABLED: true # Reference the secret ADMIN_TOKEN_FILE: \"/run/secrets/admin_token\" secrets: admin_token: file: ./admin_token.txt Next, create the /run/secrets directory and the admin_token.txt file. Enter the following into this file:\necho \"*OurVaultWardenAdminToken*\" \u003e admin_token.txt Starting the Docker Containers To start our containers, run the following command:\ndocker compose up -d To verify the containers are running properly, use the command:\ndocker ps -a Then, open a browser and enter your Vaultwarden domain here: http://YourDomain\nTo access the admin console, simply go to http://YourDomain/admin\nAlthough the connection is established via HTTP, it will be automatically redirected to HTTPS by accepting the risks associated with self-signed certificates.\nVaultwarden needs to be run in HTTPS for account creation.\nVaultWarden is now operational.\nYou need to set up DNS autorization for your Vaultwarden with your http://YourDomain\nUseful Docker Commands\n‚Ä¢ docker ps -a : #View running containers, creation date, container age, name, and ID. ‚Ä¢ docker stop /rm *container id*: #Stop (stop) and remove (rm) a container by adding its ID. ‚Ä¢ docker compose up -d : #Launch docker-compose.yml to run the containers. ","wordCount":"894","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","author":{"@type":"Person","name":"Nicolas Wailly"},"mainEntityOfPage":{"@type":"WebPage","@id":"//localhost:1313/procedures/vaultwarden/"},"publisher":{"@type":"Organization","name":"üî• Nicolas Wailly AIS DevOPs üî•","logo":{"@type":"ImageObject","url":"//localhost:1313/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=//localhost:1313/ accesskey=h title="Nicolas Wailly DevOPS-AIS (Alt + H)"><img src=//localhost:1313/images/Logo.jpeg alt aria-label=logo height=50>Nicolas Wailly DevOPS-AIS</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=//localhost:1313/devops/ title=DevOPS><span>DevOPS</span></a></li><li><a href=//localhost:1313/ais/ title=AIS><span>AIS</span></a></li><li><a href=//localhost:1313/projets/ title=Projets><span>Projets</span></a></li><li><a href=//localhost:1313/a-propos/ title="A propos"><span>A propos</span></a></li><li><a href=//localhost:1313/procedures/ title=Procedures><span>Procedures</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=//localhost:1313/>Home</a>&nbsp;¬ª&nbsp;<a href=//localhost:1313/procedures/>Procedures</a></div><h1 class="post-title entry-hint-parent"></h1><div class=post-meta>5 min&nbsp;¬∑&nbsp;Nicolas Wailly</div></header><div class=post-content><h1 id=vaultwarden-installation>Vaultwarden Installation<a hidden class=anchor aria-hidden=true href=#vaultwarden-installation>#</a></h1><p>The goal of this procedure is to simplify the installation of Vaultwarden using Docker.</p><p>Prerequisites:
A Debian machine virtual or physique; <em>the method works on multiple distributions, but commands may need to be adapted for Docker installation.</em></p><h2 id=docker-installation>Docker Installation<a hidden class=anchor aria-hidden=true href=#docker-installation>#</a></h2><h3 id=configure-the-docker-repository>Configure the Docker Repository<a hidden class=anchor aria-hidden=true href=#configure-the-docker-repository>#</a></h3><p><em>Source: <a href="https://github.com/NicolasW-7/AIS-Brief-et-TIPS/blob/main/Procedure/Docker/Installation%20Docker.md?plain=1">https://github.com/NicolasW-7/AIS-Brief-et-TIPS/blob/main/Procedure/Docker/Installation%20Docker.md?plain=1</a></em></p><ol><li><p>Update the package list:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo apt-get update
</span></span></code></pre></div></li><li><p>Install the necessary packages:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo apt-get install ca-certificates curl gnupg
</span></span></code></pre></div></li><li><p>Create the directory for the repository keys:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo install -m <span style=color:#ae81ff>0755</span> -d /etc/apt/keyrings
</span></span></code></pre></div></li><li><p>Download and add the Docker GPG key:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>curl -fsSL https://download.docker.com/linux/debian/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
</span></span></code></pre></div></li><li><p>Change the permissions of the GPG key:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo chmod a+r /etc/apt/keyrings/docker.gpg
</span></span></code></pre></div></li><li><p>Add the Docker repository to the APT sources list:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>echo <span style=color:#e6db74>&#34;deb [arch=</span><span style=color:#66d9ef>$(</span>dpkg --print-architecture<span style=color:#66d9ef>)</span><span style=color:#e6db74> signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/debian </span><span style=color:#66d9ef>$(</span>lsb_release -cs<span style=color:#66d9ef>)</span><span style=color:#e6db74> stable&#34;</span> | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null
</span></span></code></pre></div></li><li><p>Update the package list to include the Docker repository:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo apt-get update
</span></span></code></pre></div></li><li><p>Install the necessary Docker packages:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
</span></span></code></pre></div></li></ol><h3 id=verify-docker-installation>Verify Docker Installation<a hidden class=anchor aria-hidden=true href=#verify-docker-installation>#</a></h3><ol start=9><li><p>Check the status of the Docker service:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>systemctl status docker
</span></span></code></pre></div></li><li><p>If Docker is &ldquo;active (running)&rdquo;, enable the Docker service to start automatically after the machine reboots:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo systemctl enable docker
</span></span></code></pre></div></li></ol><h3 id=useful-docker-commands>Useful Docker Commands<a hidden class=anchor aria-hidden=true href=#useful-docker-commands>#</a></h3><ul><li><code>docker ps -a</code>: Shows all containers, including their status, creation date, age, name, and ID.</li><li><code>docker stop &lt;container_id></code> / <code>docker rm &lt;container_id></code>: Stops (<code>stop</code>) and removes (<code>rm</code>) a container by adding its ID.</li><li><code>docker compose up -d</code>: Runs the <code>docker-compose.yml</code> file to start the containers in detached mode (<code>-d</code>).</li></ul><h4 id=command-details>Command Details<a hidden class=anchor aria-hidden=true href=#command-details>#</a></h4><h5 id=docker-ps--a><code>docker ps -a</code><a hidden class=anchor aria-hidden=true href=#docker-ps--a>#</a></h5><p>Displays all containers, whether running or stopped, with information such as:</p><ul><li>Container ID</li><li>Image used</li><li>Command executed</li><li>Creation date</li><li>Status (running, stopped, etc.)</li><li>Exposed ports</li><li>Container names</li></ul><h5 id=docker-stop-container_id--docker-rm-container_id><code>docker stop &lt;container_id></code> / <code>docker rm &lt;container_id></code><a hidden class=anchor aria-hidden=true href=#docker-stop-container_id--docker-rm-container_id>#</a></h5><ul><li><code>docker stop &lt;container_id></code>: Stops a running container.</li><li><code>docker rm &lt;container_id></code>: Removes a stopped container.</li></ul><p><strong>Example:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>docker stop 1a2b3c4d5e6f
</span></span><span style=display:flex><span>docker rm 1a2b3c4d5e6f
</span></span></code></pre></div><h2 id=creating-self-signed-certificates-with-openssl>Creating Self-Signed Certificates with OpenSSL<a hidden class=anchor aria-hidden=true href=#creating-self-signed-certificates-with-openssl>#</a></h2><p><em>For this part, we will use self-signed certificates. In production, we will reproduce this step by copying the certificates.</em></p><ol><li><p>Once Docker is installed, we will need certificates for connecting to the VaultWarden web interface. To do this, create the <code>/ssl</code> and <code>/docker</code> directories at the root of our Debian machine if they don&rsquo;t already exist:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>mkdir /ssl
</span></span><span style=display:flex><span>mkdir /docker
</span></span></code></pre></div><p><em>/ssl will be used to store the .csr, .crt, and .key files we will create, and /docker will contain the configuration files for our containers.</em></p></li><li><p>Continue by generating the self-signed certificates. Move to the <code>/ssl</code> directory:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>cd /ssl
</span></span></code></pre></div></li><li><p>Create the following four files: .pem, .key, .crt, and .csr:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>openssl genrsa -des3 -out vaultwarden.key <span style=color:#ae81ff>2048</span>
</span></span><span style=display:flex><span>openssl req -x509 -new -nodes -key vaultwarden.key -sha256 -days <span style=color:#ae81ff>10000</span> -out vaultwarden.pem
</span></span><span style=display:flex><span>openssl genrsa -out vaultwarden.key <span style=color:#ae81ff>2048</span>
</span></span><span style=display:flex><span>openssl req -new -key vaultwarden.key -out vaultwarden.csr
</span></span><span style=display:flex><span>openssl x509 -req -days <span style=color:#ae81ff>10000</span> -in vaultwarden.csr -signkey vaultwarden.key -out vaultwarden.crt
</span></span></code></pre></div><p><em>Note: The generated certificate is valid for 10,000 days (about 27 years). This variable can be adjusted as needed. If necessary, a new certificate can be reissued on the machine using the CA created above.</em></p></li></ol><h2 id=creating-docker-composeyml-and-caddyfile-configuration-files-for-deploying-containers>Creating Docker-Compose.yml and CaddyFile Configuration Files for Deploying Containers<a hidden class=anchor aria-hidden=true href=#creating-docker-composeyml-and-caddyfile-configuration-files-for-deploying-containers>#</a></h2><h3 id=a-creating-the-caddyfile>A. Creating the Caddyfile<a hidden class=anchor aria-hidden=true href=#a-creating-the-caddyfile>#</a></h3><ol><li><p>Access the <code>/docker</code> directory and create the files necessary for deploying the Caddy and Vaultwarden containers via Docker. Start with the Caddyfile:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>nano Caddyfile
</span></span></code></pre></div></li><li><p>Copy the following content into it:</p><p><em>The first line corresponds to the title of our vaultwarden page, which will be accessible via a web browser.</em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>*your domain name* <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  tls internal
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  encode gzip
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  reverse_proxy /notifications/hub vaultwarden:3012
</span></span><span style=display:flex><span>  reverse_proxy vaultwarden:80
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p><em>To save, simply press Ctrl+X and then O.</em></p></li><li><p>With the CaddyFile created, proceed to the docker-compose.yml file:</p></li></ol><h3 id=b-creating-the-docker-composeyml-file>B. Creating the Docker-Compose.yml File<a hidden class=anchor aria-hidden=true href=#b-creating-the-docker-composeyml-file>#</a></h3><pre><code>```sh
nano docker-compose.yml
```

Copy the following content:

```sh
version: '3.7'

services:
  vaultwarden:
    image: vaultwarden/server:latest
    container_name: vaultwarden
    restart: always
    environment:
      WEBSOCKET_ENABLED: true
      ADMIN_TOKEN: #YourAdminToken
      DOMAIN: &quot;YourDomain&quot; # Your domain; vaultwarden needs to know it's https to work properly with attachments
    volumes:
      - vw-data:/data

  caddy:
    image: caddy:2
    container_name: caddy
    restart: always
    ports:
      # Needed for the ACME HTTP-01 challenge.
      - 443:443
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile:ro
      - ./ssl:/ssl
      - caddy-config:/config
      - caddy-data:/data
      - caddy-logs:/logs
    environment:
      - DOMAIN= # Your domain.
      #EMAIL: &quot;YOUR EMAIL&quot;                 # The email address to use for ACME registration.
      #LOG_FILE: &quot;/data/access.log&quot;

volumes:
  vw-data:
  caddy-config:
  caddy-data:
  caddy-logs:
```
</code></pre><h3 id=c-enabling-the-admin-console>C. Enabling the Admin Console<a hidden class=anchor aria-hidden=true href=#c-enabling-the-admin-console>#</a></h3><p>These lines enable the admin console:</p><pre><code>```sh
WEBSOCKET_ENABLED: true
ADMIN_TOKEN: YourAdminToken
```
</code></pre><p><strong>They can be omitted or modified to hide the admin console token (password).</strong></p><ol start=4><li><p>To hide the token, add these lines:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>WEBSOCKET_ENABLED: true
</span></span><span style=display:flex><span>      <span style=color:#75715e># Reference the secret</span>
</span></span><span style=display:flex><span>      ADMIN_TOKEN_FILE: <span style=color:#e6db74>&#34;/run/secrets/admin_token&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>secrets:
</span></span><span style=display:flex><span>  admin_token:
</span></span><span style=display:flex><span>    file: ./admin_token.txt
</span></span></code></pre></div></li><li><p>Next, create the <code>/run/secrets</code> directory and the <code>admin_token.txt</code> file. Enter the following into this file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>echo <span style=color:#e6db74>&#34;*OurVaultWardenAdminToken*&#34;</span> &gt; admin_token.txt
</span></span></code></pre></div></li></ol><h3 id=starting-the-docker-containers>Starting the Docker Containers<a hidden class=anchor aria-hidden=true href=#starting-the-docker-containers>#</a></h3><ol><li><p>To start our containers, run the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>docker compose up -d
</span></span></code></pre></div><p>To verify the containers are running properly, use the command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>docker ps -a  
</span></span></code></pre></div><p>Then, open a browser and enter your Vaultwarden domain here: <a href=http://YourDomain>http://YourDomain</a></p><p>To access the admin console, simply go to <a href=http://YourDomain/admin>http://YourDomain/admin</a></p><p>Although the connection is established via HTTP, it will be automatically redirected to HTTPS by accepting the risks associated with self-signed certificates.</p><p><strong>Vaultwarden needs to be run in HTTPS for account creation.</strong></p><p>VaultWarden is now operational.</p><p>You need to set up DNS autorization for your Vaultwarden with your <a href=http://YourDomain>http://YourDomain</a></p></li><li><p>Useful Docker Commands</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>‚Ä¢ docker ps -a : <span style=color:#75715e>#View running containers, creation date, container age, name, and ID.</span>
</span></span><span style=display:flex><span>‚Ä¢ docker stop /rm *container id*: <span style=color:#75715e>#Stop (stop) and remove (rm) a container by adding its ID.</span>
</span></span><span style=display:flex><span>‚Ä¢ docker compose up -d : <span style=color:#75715e>#Launch docker-compose.yml to run the containers.</span>
</span></span></code></pre></div></li></ol></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=//localhost:1313/procedures/postfix/><span class=title>¬´ Prev</span><br><span></span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=//localhost:1313/>üî• Nicolas Wailly AIS DevOPs üî•</a></span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>